Various sources scavenged from hybrid_encode utils - should be replaced
